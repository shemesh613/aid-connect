<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#1976D2">
  <meta name="description" content="Aid Connect - 砖专 砖转 拽">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <title>Aid Connect</title>
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

  <!-- Skip to main content -->
  <a href="#main-content" class="skip-link"> 转 专砖</a>

  <!-- Screen reader announcements -->
  <div id="a11y-announcer" role="status" aria-live="polite" aria-atomic="true" class="sr-only"></div>

  <!-- Header -->
  <header class="app-header" role="banner">
    <div class="header-title">
      <span class="material-icons-round" aria-hidden="true">volunteer_activism</span>
      <h1>Aid Connect</h1>
    </div>
    <div class="header-user">
      <span id="header-notification-badge" class="header-badge" style="display:none;" aria-label="转专转 砖转" role="status">0</span>
      <button class="btn-icon" onclick="navigateTo('profile')" style="border:none; background:rgba(255,255,255,0.2); color:white;" aria-label="驻专驻 砖转砖">
        <span class="material-icons-round" aria-hidden="true">person</span>
      </button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="app-content" id="main-content" role="main" tabindex="-1">

    <!-- ==================== -->
    <!-- VOLUNTEER VIEWS      -->
    <!-- ==================== -->

    <!-- View: Open Tasks (Volunteer) -->
    <div id="view-tasks" class="view active" role="region" aria-label="砖转 驻转转">
      <!-- Notification Permission Prompt -->
      <div id="notification-prompt" class="notification-prompt" style="display:none;" role="alert">
        <span class="material-icons-round" aria-hidden="true">notifications_active</span>
        <p>拽 转专转 注 砖转 砖转  转</p>
        <button class="btn btn-primary btn-sm" onclick="requestNotificationPermission()" aria-label="驻砖专 拽转 转专转">
          <span class="material-icons-round" aria-hidden="true">check</span>
          驻砖专 转专转
        </button>
      </div>

      <!-- Filter Chips -->
      <div class="filter-chips" role="toolbar" aria-label="住 砖转 驻 住">
        <button class="chip active" data-filter="all" onclick="filterTasks('all')" aria-pressed="true" aria-label="爪 "></button>
        <button class="chip" data-filter="medical" onclick="filterTasks('medical')" aria-pressed="false" aria-label="住 驻 专驻"> 专驻</button>
        <button class="chip" data-filter="transport" onclick="filterTasks('transport')" aria-pressed="false" aria-label="住 驻 住注"> 住注</button>
        <button class="chip" data-filter="shopping" onclick="filterTasks('shopping')" aria-pressed="false" aria-label="住 驻 拽转"> 拽转</button>
        <button class="chip" data-filter="general" onclick="filterTasks('general')" aria-pressed="false" aria-label="住 驻 注专 转"> 注专</button>
      </div>

      <!-- Tasks List -->
      <div class="section-header">
        <div class="section-title">
          <span class="material-icons-round" aria-hidden="true">assignment</span>
          <h2 class="sr-only">砖转 驻转转</h2>
          <span aria-hidden="true">砖转 驻转转</span>
        </div>
        <span id="open-tasks-count" class="chip" aria-label="住驻专 砖转 驻转转" role="status">0</span>
      </div>
      <div id="tasks-list" class="task-list" role="list" aria-label="专砖转 砖转 驻转转" aria-live="polite">
        <!-- Tasks loaded dynamically -->
      </div>
      <div id="tasks-empty" class="empty-state" style="display:none;" role="status">
        <span class="material-icons-round" aria-hidden="true">check_circle</span>
        <p> 砖转 驻转转 专注</p>
        <small>砖转 砖转 驻注 </small>
      </div>
    </div>

    <!-- View: Map -->
    <div id="view-map" class="view" role="region" aria-label="驻转 砖转">
      <div class="section-header">
        <div class="section-title">
          <span class="material-icons-round" aria-hidden="true">map</span>
          <h2 class="sr-only">驻转 砖转</h2>
          <span aria-hidden="true">驻转 砖转</span>
        </div>
      </div>
      <div id="tasks-map" style="height:calc(100vh - 200px); border-radius:var(--radius); overflow:hidden; margin-top:8px;"></div>
    </div>

    <!-- View: My Tasks (Volunteer) -->
    <div id="view-my-tasks" class="view" role="region" aria-label="砖转 砖">
      <div class="section-header">
        <div class="section-title">
          <span class="material-icons-round" aria-hidden="true">assignment_ind</span>
          <h2 class="sr-only">砖转 砖</h2>
          <span aria-hidden="true">砖转 砖</span>
        </div>
      </div>
      <div id="my-tasks-list" class="task-list" role="list" aria-label="专砖转 砖转 砖" aria-live="polite">
        <!-- My tasks loaded dynamically -->
      </div>
      <div id="my-tasks-empty" class="empty-state" style="display:none;" role="status">
        <span class="material-icons-round" aria-hidden="true">volunteer_activism</span>
        <p>注  拽转 砖转</p>
        <small>抓 " 拽!" 注 砖  转</small>
      </div>
    </div>

    <!-- ==================== -->
    <!-- ADMIN VIEWS          -->
    <!-- ==================== -->

    <!-- View: Dashboard (Admin) -->
    <div id="view-dashboard" class="view" role="region" aria-label=" 拽专">
      <div class="stats-grid" role="group" aria-label="住住拽转 砖转">
        <div class="stat-card" role="figure" aria-label="住&quot; 砖转">
          <div class="stat-number" id="stat-total" aria-live="polite">0</div>
          <div class="stat-label">住" 砖转</div>
        </div>
        <div class="stat-card active" role="figure" aria-label="砖转 驻转转">
          <div class="stat-number" id="stat-open" aria-live="polite">0</div>
          <div class="stat-label">驻转转</div>
        </div>
        <div class="stat-card urgent" role="figure" aria-label="砖转 驻转">
          <div class="stat-number" id="stat-urgent" aria-live="polite">0</div>
          <div class="stat-label">驻转</div>
        </div>
        <div class="stat-card done" role="figure" aria-label="砖转 砖砖">
          <div class="stat-number" id="stat-completed" aria-live="polite">0</div>
          <div class="stat-label">砖</div>
        </div>
      </div>

      <!-- Recent tasks -->
      <div class="section-header">
        <div class="section-title">
          <span class="material-icons-round" aria-hidden="true">history</span>
          <h2 class="sr-only">砖转 专转</h2>
          <span aria-hidden="true">砖转 专转</span>
        </div>
      </div>
      <div id="admin-tasks-list" class="task-list" role="list" aria-label="专砖转 砖转 专转" aria-live="polite">
        <!-- Admin tasks loaded dynamically -->
      </div>
    </div>

    <!-- View: Create Task (Admin) -->
    <div id="view-create" class="view" role="region" aria-label="爪专转 砖 砖">
      <div class="create-task-section">
        <h2>
          <span class="material-icons-round" aria-hidden="true">add_task</span>
          砖 砖
        </h2>

        <div class="input-group">
          <label id="task-type-label">住 砖</label>
          <div class="task-type-selector" role="radiogroup" aria-labelledby="task-type-label">
            <button class="type-btn" data-type="medical" onclick="selectTaskType('medical')" role="radio" aria-checked="false" aria-label="专驻"> 专驻</button>
            <button class="type-btn" data-type="transport" onclick="selectTaskType('transport')" role="radio" aria-checked="false" aria-label="住注"> 住注</button>
            <button class="type-btn" data-type="shopping" onclick="selectTaskType('shopping')" role="radio" aria-checked="false" aria-label="拽转"> 拽转</button>
            <button class="type-btn" data-type="general" onclick="selectTaskType('general')" role="radio" aria-checked="false" aria-label="注专 转"> 注专</button>
          </div>
        </div>

        <div class="input-group">
          <label for="task-title">转专转</label>
          <input type="text" id="task-title" placeholder="转专 拽爪专 砖 砖" aria-required="true">
        </div>

        <div class="input-group">
          <label for="task-desc">驻专</label>
          <textarea id="task-desc" placeholder="驻专 住驻, 转 转..." aria-describedby="task-desc-hint"></textarea>
          <span id="task-desc-hint" class="sr-only">住祝 驻专 住驻 转 转 爪注 砖</span>
        </div>

        <div class="input-group">
          <label id="urgency-label">驻转</label>
          <div class="urgency-selector" role="radiogroup" aria-labelledby="urgency-label">
            <button class="urgency-btn high" data-urgency="high" onclick="selectUrgency('high')" role="radio" aria-checked="false" aria-label="驻转 "> </button>
            <button class="urgency-btn medium" data-urgency="medium" onclick="selectUrgency('medium')" role="radio" aria-checked="false" aria-label="驻转 转"> 转</button>
            <button class="urgency-btn low" data-urgency="low" onclick="selectUrgency('low')" role="radio" aria-checked="false" aria-label="驻转 "> </button>
          </div>
        </div>

        <div class="input-group">
          <label id="location-label">拽</label>
          <div class="location-inputs" role="group" aria-labelledby="location-label">
            <input type="text" id="task-location-from" placeholder="... (转转 爪)" aria-label="转转 爪">
            <input type="text" id="task-location-to" placeholder="... (转转 注)" aria-label="转转 注">
          </div>
        </div>

        <div class="input-group">
          <label for="task-contact">驻 爪专转 拽砖专</label>
          <input type="tel" id="task-contact" placeholder="050-1234567" autocomplete="tel">
        </div>

        <button id="btn-create-task" class="btn btn-primary btn-full" onclick="createTask()" aria-label="砖专 砖 砖">
          <span class="material-icons-round" aria-hidden="true">send</span>
          砖专 砖
        </button>
      </div>
    </div>

    <!-- View: Volunteers Management (Admin) -->
    <div id="view-volunteers" class="view" role="region" aria-label=" 转">
      <div class="section-header">
        <div class="section-title">
          <span class="material-icons-round" aria-hidden="true">groups</span>
          <h2 class="sr-only">转</h2>
          <span aria-hidden="true">转</span>
        </div>
        <span id="volunteers-count" class="chip" aria-label="住驻专 转" role="status">0</span>
      </div>
      <div id="volunteers-list" class="task-list" role="list" aria-label="专砖转 转" aria-live="polite">
        <!-- Volunteers loaded dynamically -->
      </div>
    </div>

    <!-- ==================== -->
    <!-- SHARED VIEWS         -->
    <!-- ==================== -->

    <!-- View: Profile -->
    <div id="view-profile" class="view" role="region" aria-label="驻专驻 砖转砖">
      <div class="profile-card" role="group" aria-label="驻专 砖转砖">
        <div class="profile-avatar" id="profile-avatar" aria-hidden="true">?</div>
        <div class="profile-name" id="profile-name" role="heading" aria-level="2">-</div>
        <div class="profile-role" id="profile-role">-</div>
        <div class="profile-stats" role="group" aria-label="住住拽转 砖转砖">
          <div class="profile-stat-item">
            <div class="profile-stat-value" id="profile-tasks-taken" aria-live="polite">0</div>
            <div class="profile-stat-label">拽</div>
          </div>
          <div class="profile-stat-item">
            <div class="profile-stat-value" id="profile-tasks-completed" aria-live="polite">0</div>
            <div class="profile-stat-label">砖</div>
          </div>
          <div class="profile-stat-item">
            <div class="profile-stat-value" id="profile-tasks-created" aria-live="polite">0</div>
            <div class="profile-stat-label">爪专</div>
          </div>
        </div>
      </div>

      <div class="profile-actions" role="group" aria-label="驻注转 驻专驻">
        <button class="profile-action-btn" onclick="toggleNotifications()" aria-label="专转 转专转">
          <span class="material-icons-round" aria-hidden="true">notifications</span>
          <span>专转 转专转</span>
        </button>
        <button id="btn-org-settings" class="profile-action-btn" onclick="openOrgSettings()" style="display:none;" aria-label="砖 砖 专">
          <span class="material-icons-round" aria-hidden="true">edit</span>
          <span>砖 砖 专</span>
        </button>
        <button class="profile-action-btn" onclick="shareApp()" aria-label="砖转祝 转 驻拽爪">
          <span class="material-icons-round" aria-hidden="true">share</span>
          <span>砖转祝 转 驻拽爪</span>
        </button>
        <a href="accessibility-statement.html" class="profile-action-btn" aria-label="爪专转 砖转">
          <span class="material-icons-round" aria-hidden="true">accessible</span>
          <span>爪专转 砖转</span>
        </a>
        <button class="profile-action-btn danger" onclick="logout()" aria-label="转转拽转 注专转">
          <span class="material-icons-round" aria-hidden="true">logout</span>
          <span>转转拽转</span>
        </button>
      </div>

      <!-- Developer Branding -->
      <div class="developer-branding app-branding" role="contentinfo" aria-label="注 注 驻转">
        <img src="icons/developer-logo.jpeg" alt=" 砖砖 '拽 AI" class="developer-logo">
        <div class="developer-info">
          <span class="developer-name">驻转 注" 砖砖 '拽 AI</span>
          <a href="tel:0526953500" class="developer-phone" aria-label="驻 转: 052-695-3500"> 转: 052-695-3500</a>
        </div>
      </div>
    </div>

  </main>

  <!-- Bottom Navigation - Volunteer -->
  <nav id="nav-volunteer" class="bottom-nav" style="display:none;" role="navigation" aria-label=" 专砖 - 转">
    <button class="nav-item active" data-view="tasks" onclick="navigateTo('tasks')" aria-label="砖转 驻转转" aria-current="page">
      <span class="material-icons-round" aria-hidden="true">assignment</span>
      <span>砖转</span>
      <span class="nav-badge" id="nav-badge-tasks" style="display:none;" aria-label="砖转 砖转" role="status">0</span>
    </button>
    <button class="nav-item" data-view="map" onclick="navigateTo('map')" aria-label="驻转 砖转">
      <span class="material-icons-round" aria-hidden="true">map</span>
      <span>驻</span>
    </button>
    <button class="nav-item" data-view="my-tasks" onclick="navigateTo('my-tasks')" aria-label="砖转 砖">
      <span class="material-icons-round" aria-hidden="true">assignment_ind</span>
      <span>砖</span>
    </button>
    <button class="nav-item" data-view="profile" onclick="navigateTo('profile')" aria-label="驻专驻">
      <span class="material-icons-round" aria-hidden="true">person</span>
      <span>驻专驻</span>
    </button>
  </nav>

  <!-- Bottom Navigation - Admin -->
  <nav id="nav-admin" class="bottom-nav" style="display:none;" role="navigation" aria-label=" 专砖 - ">
    <button class="nav-item active" data-view="dashboard" onclick="navigateTo('dashboard')" aria-label=" 拽专" aria-current="page">
      <span class="material-icons-round" aria-hidden="true">dashboard</span>
      <span> 拽专</span>
    </button>
    <button class="nav-item" data-view="create" onclick="navigateTo('create')" aria-label="爪专转 砖 砖">
      <span class="material-icons-round" aria-hidden="true">add_circle</span>
      <span>砖 砖</span>
    </button>
    <button class="nav-item" data-view="volunteers" onclick="navigateTo('volunteers')" aria-label=" 转">
      <span class="material-icons-round" aria-hidden="true">groups</span>
      <span>转</span>
    </button>
    <button class="nav-item" data-view="profile" onclick="navigateTo('profile')" aria-label="驻专驻">
      <span class="material-icons-round" aria-hidden="true">person</span>
      <span>驻专驻</span>
    </button>
  </nav>

  <!-- FAB for Admin (quick create) -->
  <button id="fab-create" class="fab" style="display:none;" onclick="navigateTo('create')" aria-label="爪专转 砖 砖">
    <span class="material-icons-round" aria-hidden="true">add</span>
  </button>

  <!-- Task Detail Modal -->
  <div id="modal-task-detail" class="modal-overlay" onclick="closeModal(event)" role="dialog" aria-modal="true" aria-label="驻专 砖" aria-hidden="true">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-handle" aria-hidden="true"></div>
      <button class="sr-only" id="modal-close-sr" onclick="closeModal(event)" aria-label="住专  驻专 砖">住专</button>
      <div id="task-detail-content" class="task-detail" aria-live="polite">
        <!-- Filled dynamically -->
      </div>
    </div>
  </div>

  <!-- Org Settings Modal -->
  <div id="modal-org-settings" class="modal-overlay" onclick="closeOrgSettings(event)" role="dialog" aria-modal="true" aria-labelledby="org-settings-title" aria-hidden="true">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-handle" aria-hidden="true"></div>
      <h3 id="org-settings-title" style="margin-bottom:16px; display:flex; align-items:center; gap:8px;">
        <span class="material-icons-round" aria-hidden="true">settings</span>
        专转 专
      </h3>
      <div class="input-group">
        <label for="org-name">砖 专 / 驻拽爪</label>
        <input type="text" id="org-name" placeholder="Aid Connect">
      </div>
      <div class="input-group">
        <label for="org-desc">转专 拽爪专</label>
        <input type="text" id="org-desc" placeholder="砖专 砖转 拽">
      </div>
      <div class="input-group">
        <label for="org-phone">驻 爪专转 拽砖专</label>
        <input type="tel" id="org-phone" placeholder="050-1234567" autocomplete="tel">
      </div>
      <div class="input-group">
        <label for="org-admin-code">拽 住 </label>
        <input type="text" id="org-admin-code" placeholder="拽 住 专砖  砖">
        <small style="color:var(--text-light); font-size:0.75rem;">砖转祝 拽  专拽 注  专砖</small>
      </div>
      <button class="btn btn-primary btn-full" onclick="saveOrgSettings()" aria-label="砖专 专转 专">
        <span class="material-icons-round" aria-hidden="true">save</span>
        砖专
      </button>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true"></div>

  <!-- Install Banner -->
  <div id="install-banner" class="install-banner" role="complementary" aria-label="转拽转 驻拽爪">
    <div class="install-banner-icon" aria-hidden="true">
      <span class="material-icons-round">download</span>
    </div>
    <div class="install-banner-text">
      <strong>转拽 转 Aid Connect</strong>
      <small>砖 专 住 专砖</small>
    </div>
    <button class="btn btn-primary btn-sm" onclick="installApp()" aria-label="转拽 转 驻拽爪">转拽</button>
    <button class="btn-icon" onclick="dismissInstallBanner()" style="border:none;" aria-label="住专 专 转拽">
      <span class="material-icons-round" aria-hidden="true">close</span>
    </button>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-messaging-compat.js"></script>

  <script>
    // Firebase Config (inline to avoid module issues)
    const firebaseConfig = {
      apiKey: "AIzaSyAiX5hNA0nHE5Ose3XoHY84n3y99pdL4F8",
      authDomain: "aid-connect-2059d.firebaseapp.com",
      projectId: "aid-connect-2059d",
      storageBucket: "aid-connect-2059d.firebasestorage.app",
      messagingSenderId: "214156347220",
      appId: "1:214156347220:web:bbde9a71c36119b1db6ac1",
      measurementId: "G-EFGWRRGVJ4"
    };
    const VAPID_KEY = "BCLj0E0no-V4aMHDFT3JaOGJG4FODd3GWMdYTdHyaP0jhkjHxxPItV9cJdB6b-Qszn1y6h7E7wNPWkLwfJWspQg";

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    let messaging = null;
    try { messaging = firebase.messaging(); } catch(e) { console.log('Messaging not supported'); }
    auth.languageCode = 'he';
  </script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="js/notifications.js"></script>
  <script src="js/tasks.js"></script>
  <script src="js/map.js"></script>
  <script src="js/app.js"></script>
  <script src="js/accessibility.js"></script>
</body>
</html>
